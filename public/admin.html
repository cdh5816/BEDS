<!-- © AIRX (individual business). All rights reserved.
     This codebase is owned by the user (AIRX) for the Deb's (Detection Earthquake Building System) project.
-->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Deb's · 관리자 콘솔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <link rel="stylesheet" href="styles.css" />
</head>

<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col">
  <header class="app-header">
    <div>
      <h1 class="app-title">Deb's 관리자</h1>
      <p class="subtitle">현장 관리 · 상태/공사상태 · 좌표/주소 보정</p>
    </div>
    <nav class="app-nav">
      <a href="index.html" class="nav-link">메인</a>
      <a href="client.html" class="nav-link" id="nav-monitor">모니터링</a>
      <a href="accounts.html" class="nav-link">고객 계정</a>
      <span class="nav-link nav-link-active">현장 관리</span>
      <button id="logout-btn" class="btn btn-secondary btn-nav">로그아웃</button>
    </nav>
  </header>

  <main class="layout">
    <!-- LEFT: list + map + detail -->
    <section class="panel panel-sites">
      <div class="panel-header">
        <div>
          <h2 class="text-sm font-semibold text-slate-100">등록된 현장</h2>
          <div id="site-summary" class="site-summary mt-1"></div>
        </div>

        <div class="admin-actions">
          <button id="open-create-modal" class="btn btn-primary">+ 새 현장</button>
        </div>
      </div>

      <div class="admin-filters">
        <label class="admin-filter">
          상태
          <select id="status-filter">
            <option value="ALL">전체</option>
            <option value="SAFE">안전</option>
            <option value="CAUTION">주의</option>
            <option value="ALERT">경고</option>
          </select>
        </label>

        <label class="admin-filter">
          공사상태
          <select id="construction-filter">
            <option value="ALL">전체</option>
            <option value="IN_PROGRESS">진행중</option>
            <option value="DONE">완료</option>
          </select>
        </label>

        <label class="admin-filter admin-filter-wide">
          검색
          <input id="q-filter" type="text" placeholder="현장명/주소/메모" />
        </label>
      </div>

      <div id="admin-map" class="site-map rounded-2xl overflow-hidden border border-slate-800"></div>

      <div id="site-detail" class="admin-detail-card">
        <div class="admin-detail-title">선택된 현장</div>
        <div id="site-detail-body" class="admin-detail-body">왼쪽 목록에서 현장을 선택하세요.</div>
      </div>

      <div id="site-list" class="site-list"></div>
    </section>

    <!-- RIGHT: edit form -->
    <section class="panel panel-form">
      <div class="flex items-start justify-between gap-2">
        <div>
          <h2 class="text-sm font-semibold text-slate-100">현장 수정</h2>
          <p class="help-text">선택된 현장만 수정됩니다. 저장은 즉시 반영됩니다.</p>
        </div>
        <span id="edit-badge" class="admin-mini-badge hidden">선택됨</span>
      </div>

      <form id="edit-form">
        <input type="hidden" id="edit-id" />

        <div class="form-row">
          <label for="edit-name">현장명<span class="required">*</span></label>
          <input type="text" id="edit-name" required placeholder="예: 서울역 타워 A동" />
        </div>

        <div class="form-row">
          <label for="edit-address">주소<span class="required">*</span></label>
          <input type="text" id="edit-address" required placeholder="예: 서울특별시 ..." />
          <div class="mt-2 flex gap-2">
            <button type="button" id="edit-geocode" class="btn btn-secondary text-xs">주소 검색</button>
            <button type="button" id="edit-use-picked" class="btn btn-secondary text-xs">지도 핀 좌표 반영</button>
          </div>
          <div id="edit-geocode-results" class="geocode-results"></div>
        </div>

        <div class="form-row">
          <label>좌표(위도/경도)</label>
          <div class="grid grid-cols-2 gap-2">
            <input type="text" id="edit-lat" placeholder="위도 (예: 37.5665)" />
            <input type="text" id="edit-lon" placeholder="경도 (예: 126.9780)" />
          </div>
          <p class="help-text">지도에서 핀을 찍으면 자동으로 “선택 좌표”가 갱신됩니다.</p>
        </div>

        <div class="form-row">
          <label for="edit-status">안전 상태</label>
          <select id="edit-status">
            <option value="SAFE">SAFE (안전)</option>
            <option value="CAUTION">CAUTION (주의)</option>
            <option value="ALERT">ALERT (경고)</option>
          </select>
        </div>

        <div class="form-row">
          <label for="edit-construction">공사 상태</label>
          <select id="edit-construction">
            <option value="IN_PROGRESS">IN_PROGRESS (진행중)</option>
            <option value="DONE">DONE (완료)</option>
          </select>
        </div>

        <div class="form-row">
          <label for="edit-sensorCount">센서 설치 개수</label>
          <input type="number" id="edit-sensorCount" min="0" placeholder="예: 3" />
        </div>

        <div class="form-row">
          <label for="edit-buildingSize">건물 규모 / 연면적</label>
          <input type="text" id="edit-buildingSize" placeholder="예: 12,000㎡, 20F, 대형" />
        </div>

        <div class="form-row">
          <label for="edit-buildingYear">준공 연도</label>
          <input type="text" id="edit-buildingYear" placeholder="예: 2005" />
        </div>

        <div class="form-row">
          <label for="edit-notes">메모 (분류용)</label>
          <textarea id="edit-notes" rows="3" placeholder="예: 병원동, 내진설계 적용, B동만 계측 등"></textarea>
        </div>

        <div class="admin-form-actions">
          <button type="submit" class="btn btn-primary">저장</button>
          <button type="button" id="delete-site" class="btn btn-secondary">삭제</button>
        </div>

        <p id="edit-msg" class="form-message text-slate-400"></p>

        <!-- Pick info -->
        <div class="admin-pick-card">
          <div class="admin-pick-title">지도에서 핀 찍기 (좌표/주소 보정)</div>
          <div class="admin-pick-grid">
            <div><span class="text-slate-400">선택 좌표:</span> <span id="pick-coords">-</span></div>
            <div><span class="text-slate-400">좌표 기반 주소:</span> <span id="pick-address">-</span></div>
          </div>
          <div class="mt-2 flex gap-2">
            <button type="button" id="pick-clear" class="btn btn-secondary text-xs">핀 지우기</button>
          </div>
        </div>
      </form>
    </section>
  </main>

  <footer class="app-footer">
    <span class="text-[11px] text-slate-500">Deb's · © AIRX (individual business)</span>
  </footer>

  <!-- =========================
       CREATE MODAL (새 현장)
       ========================= -->
  <div id="create-modal" class="admin-modal hidden">
    <div id="create-modal-backdrop" class="admin-modal-backdrop"></div>
    <div class="admin-modal-card">
      <div class="admin-modal-head">
        <div>
          <div class="text-xs text-slate-400">새 현장 추가</div>
          <div class="text-sm font-semibold text-slate-100">현장 등록</div>
        </div>
        <button id="close-create-modal" class="btn btn-secondary text-xs">닫기</button>
      </div>

      <form id="create-form" class="mt-3">
        <div class="form-row">
          <label for="create-name">현장명<span class="required">*</span></label>
          <input id="create-name" type="text" required />
        </div>

        <div class="form-row">
          <label for="create-address">주소<span class="required">*</span></label>
          <input id="create-address" type="text" required />
          <div class="mt-2 flex gap-2">
            <button type="button" id="create-geocode" class="btn btn-secondary text-xs">주소 검색</button>
            <button type="button" id="create-use-picked" class="btn btn-secondary text-xs">지도 핀 좌표 반영</button>
          </div>
          <div id="create-geocode-results" class="geocode-results"></div>
        </div>

        <div class="form-row">
          <label>좌표(위도/경도)</label>
          <div class="grid grid-cols-2 gap-2">
            <input id="create-lat" type="text" placeholder="위도" />
            <input id="create-lon" type="text" placeholder="경도" />
          </div>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <div class="form-row">
            <label for="create-status">안전 상태</label>
            <select id="create-status">
              <option value="SAFE">SAFE</option>
              <option value="CAUTION">CAUTION</option>
              <option value="ALERT">ALERT</option>
            </select>
          </div>
          <div class="form-row">
            <label for="create-construction">공사 상태</label>
            <select id="create-construction">
              <option value="IN_PROGRESS">IN_PROGRESS</option>
              <option value="DONE">DONE</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <div class="form-row">
            <label for="create-sensorCount">센서 수</label>
            <input id="create-sensorCount" type="number" min="0" value="0" />
          </div>
          <div class="form-row">
            <label for="create-buildingYear">준공 연도</label>
            <input id="create-buildingYear" type="text" placeholder="예: 2010" />
          </div>
        </div>

        <div class="form-row">
          <label for="create-buildingSize">건물 규모</label>
          <input id="create-buildingSize" type="text" placeholder="예: 12,000㎡, 20F" />
        </div>

        <div class="form-row">
          <label for="create-notes">메모</label>
          <textarea id="create-notes" rows="3"></textarea>
        </div>

        <div class="admin-form-actions">
          <button type="submit" class="btn btn-primary">등록</button>
          <button type="button" id="create-clear-picked" class="btn btn-secondary">핀 지우기</button>
        </div>

        <p id="create-msg" class="form-message text-slate-400"></p>
      </form>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="admin.js"></script>
</body>
</html>
